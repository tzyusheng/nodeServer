# Node SDK文档

本文档主要介绍图像审核服务。在使用本文档前，您需要先了解图像审核服务。

# 安装图像审核服务 Node SDK

**Node SDK目录结构**

        ├── src
        │  ├── auth                                // 授权相关类
        │  ├── http                                // Http通信相关类
        │  ├── client                              // 公用类
        │  ├── util                                // 工具类
        │  └── const                               // 常量类
        ├── AipImageCensor.js                      // 图像审核交互类
        ├── index.js                               // 入口文件
        └── package.json                           // npm包描述文件

**支持 node 版本 4.0+**

**直接使用node开发包步骤如下：**

1.在[官方网站](http://ai.baidu.com/sdk)下载node SDK压缩包。

2.将下载的`aip-node-sdk-version.zip`解压后，复制到工程文件夹中。

3.进入目录运行npm安装sdk依赖库

4.把目录当做模块依赖

其中，`version`为版本号，添加完成后，用户就可以在工程中使用图像审核 Node SDK。

**直接使用npm安装依赖：**

暂无

# 快速入门

图像审核服务，依托百度业界领先的图像识别算法，基于大数据深度学习技术，提供图片色情、暴恐识别服务。

## 新建AipImageCensorClient

用户可以参考如下代码新建一AipAntipornClient：

```
var AipImageCensor = require("baidu-ai").imageCensor;

// 设置APPID/AK/SK
var APP_ID = "你的 App ID";
var API_KEY = "你的 Api ID";
var SECRET_KEY = "你的 Secret Key";

var client = new AipImageCensor(APP_ID, API_KEY, SECRET_KEY);
```
在上面代码中，常量`APP_ID`在百度云控制台中创建，常量`API_KEY`与`SECRET_KEY`是在创建完毕应用后，系统分配给用户的，均为字符串，用于标识用户，为访问做签名验证，可在AI服务控制台中的**应用列表**中查看。

**注意：**如您以前是百度云的老用户，其中`API_KEY`对应百度云的“Access Key ID”，`SECRET_KEY`对应百度云的“Access Key Secret”。



# 色情识别

图片接受类型为base64编码格式字符串。

```
var fs = require('fs');
var image = fs.readFileSync('assets/antiporn/porn.jpg');
var base64Img = new Buffer(image).toString('base64');
client.antiporn(base64Img).then(function(result) {
	console.log(JSON.stringify(result));
});
```

**色情识别 请求参数详情**

| 参数    | 类型     | 描述                                       | 是否必须 |
| :---- | :----- | :--------------------------------------- | :--- |
| image | String | 图像数据，类型为base64编码格式字符串，支持jpg/png/bmp/gif格式（目前gif图片只取第一帧检测） | 是    |

**色情识别 返回数据参数详情**

| 参数           | 类型            | 描述                          |
| :----------- | :------------ | :-------------------------- |
| log_id       | uint64        | 请求标识码，随机数，唯一                |
| conclusion   | string        | 色情识别分类结论 |
| confidence_coefficient | string | “conclusion”结论的置信度，值为"确定"或"不确定" |
| result_num   | Int           | 返回结果数目，即：result数组中元素个数      |
| result       | Array[Object] | 结果数组，每项内容对应一个分类维度的结果        |
| +class_name  | String        | 分类结果名称，示例：色情                |
| +probability | double        | 分类结果置信度，示例：0.89471650123596 |

# GIF色情图像识别

图片接受类型为base64编码格式字符串，，此接口只支持gif识别，若非gif接口，请使用[色情识别](#色情识别)接口。接口会对图片中每一帧进行识别，并返回所有检测结果中色情值最大的为结果。

```
var fs = require('fs');
var image = fs.readFileSync('assets/antiporn/porn.gif');
var base64Img = new Buffer(image).toString('base64');
client.antipornGif(base64Img).then(function(result) {
	console.log(JSON.stringify(result));
});
```

**GIF色情图像识别 请求参数详情**

| 参数    | 类型     | 描述                        | 是否必须 |
| :---- | :----- | :------------------------ | :--- |
| image | String | 图像数据，类型为base64编码格式字符串 | 是    |

**GIF色情图像识别 访问限制**

| 检查项       | 限制条件            |
| --------- | --------------- |
| 图片格式      | gif             |
| 每帧编码后大小   | < 4M            |
| 帧数        | 不超过50           |
| GIF图片整体大小 | base64编码后不超过20M |

**GIF色情图像识别 返回数据参数详情**

| 参数               | 类型            | 描述                          |
| :--------------- | :------------ | :-------------------------- |
| log_id           | uint64        | 请求标识码，随机数，唯一                |
| frame_count      | uint64        | gif总帧数                      |
| porn_probability | double        | 色情识别置信度                     |
| result_num       | Int           | 返回结果数目，即：result数组中元素个数      |
| result           | Array[Object] | 结果数组，每项内容对应一个分类维度的结果        |
| +class_name      | String        | 分类结果名称，示例：色情                |
| +probability     | double        | 分类结果置信度，示例：0.89471650123596 |

**返回示例**

```json
{
    "log_id": 1744190292,
    "frame_count": 9,
    "porn_probability":0.41608
    "result_num": 3,
    "result": [
        {
            "class_name": "色情",
            "probability": 0.41608
        },
        {
            "class_name": "性感",
            "probability": 0.249851
        },
        {
            "class_name": "正常",
            "probability": 0.334069
        }
    ]
}
```

# 暴恐图像识别

图片接受类型为base64编码格式字符串。

```
var fs = require('fs');
var image = fs.readFileSync('assets/antiporn/terror.gif');
var base64Img = new Buffer(image).toString('base64');
client.antiTerror(base64Img).then(function(result) {
    console.log(JSON.stringify(result));
});
```

**暴恐图像识别 请求参数详情**

| 参数    | 类型     | 描述                        | 是否必须 |
| :---- | :----- | :------------------------ | :--- |
| image | String | 图像数据，类型为base64编码格式字符串 | 是    |

**暴恐图像识别 返回数据参数详情**

| 参数               | 类型            | 描述                          |
| :--------------- | :------------ | :-------------------------- |
| log_id           | uint64        | 请求标识码，随机数，唯一                |
| result           | double | 暴恐结果置信度 |

**返回示例**

```json
{
    "log_id": 1744190292,
    "result": 0.8772231
}
```

# 错误信息格式

若请求错误，服务器将返回的JSON文本包含以下参数：

* **error_code：**错误码；关于错误码的详细信息请参考**通用错误码**和**业务相关错误码**。
* **error_msg：**错误描述信息，帮助理解和解决发生的错误。

**服务端返回的错误码**

| 错误码    | 错误信息                     | 描述          |
| ------ | ------------------------ | ----------- |
| 216015 | module closed            | 模块关闭        |
| 216100 | invalid param            | 非法参数        |
| 216101 | not enough param         | 参数数量不够      |
| 216102 | service not support      | 业务不支持       |
| 216103 | param too long           | 参数太长        |
| 216110 | appid not exist          | APP ID不存在   |
| 216111 | invalid userid           | 非法用户ID      |
| 216200 | empty image              | 空的图片        |
| 216201 | image format error       | 图片格式错误      |
| 216202 | image size error         | 图片大小错误      |
| 216300 | db error                 | DB错误        |
| 216400 | backend error            | 后端系统错误      |
| 216401 | internal error           | 内部错误        |
| 216402 | face not found           | 没有找到人脸      |
| 216500 | unknown error            | 未知错误        |
|282000 | internal error| 服务器内部错误，请再次请求， 如果持续出现此类错误，请通过QQ群（375765194）或工单联系技术支持团队。|
| 282002 | input encoding error    	           | 请求参数编码错误 |
| 282100 | image transcode error                   | 图片压缩转码错误       |
| 282202 | antiporn detect timeout  | 检测超时        |
| 282203 | image frame size error   | gif单帧大小超限   |
| 282204 | image frames limit error | gif总帧数超限    |
| 282205 | image fromat must gif    | 图片格式错误      |

# 版本更新记录

| 上线日期      | 版本号  | 更新内容                             |
| --------- | ---- | -------------------------------- |
| 2017.5.26 | 1.0.0 | 初版  |








